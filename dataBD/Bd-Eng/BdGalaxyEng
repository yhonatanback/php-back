--  1. Tabla de pa铆ses
CREATE TABLE country (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID del pa铆s
  name TEXT NOT NULL,                             -- Nombre del pa铆s
  iso_code CHAR(2) NOT NULL,                      -- C贸digo ISO (ej: CO, US)
  flag_url TEXT,                                  -- URL de la bandera del pa铆s
  dialing_code VARCHAR(10)                        -- C贸digo telef贸nico internacional (ej: +57)
);

--  2. Tabla principal de usuarios
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID del usuario
  email VARCHAR(100) UNIQUE NOT NULL,             -- Correo electr贸nico del usuario
  user_type VARCHAR(20) NOT NULL,                 -- Tipo de usuario (cliente, empresa, externo, admin)
  state VARCHAR(20) DEFAULT 'pending',            -- Estado de la cuenta del usuario (pendiente, activo, bloqueado)
  accept_terms BOOLEAN DEFAULT FALSE,             -- Acept贸 los t茅rminos y condiciones
  accept_polits BOOLEAN DEFAULT FALSE,            -- Acept贸 la pol铆tica de privacidad
  created_at TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP,  -- Fecha de creaci贸n del registro
  updated_at TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP   -- Fecha de 煤ltima actualizaci贸n
);

--  3. Datos secundarios del usuario
CREATE TABLE user_data (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID del registro
  user_id INT NOT NULL,                           -- Relaci贸n con el usuario (users.id)
  name VARCHAR(50),                               -- Nombre del usuario
  family_name VARCHAR(50),                        -- Apellido del usuario
  phone VARCHAR(20),                              -- N煤mero de tel茅fono
  address VARCHAR(45),                            -- Direcci贸n principal
  address_secondary VARCHAR(45),                  -- Direcci贸n secundaria o adicional
  postal_code VARCHAR(10),                        -- C贸digo postal
  country_id INT,                                 -- Pa铆s de residencia
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (country_id) REFERENCES country(id)
);

--  4. Autenticaci贸n por contrase帽a
CREATE TABLE user_auth (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID de autenticaci贸n
  user_id INT NOT NULL,                           -- Relaci贸n con el usuario
  password VARCHAR(255),                          -- Contrase帽a cifrada (hash)
  created_at TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP, -- Fecha de creaci贸n
  updated_at TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP, -- ltima modificaci贸n
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

--  5. M茅todos de autenticaci贸n del usuario
CREATE TABLE auth_methods (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID del m茅todo
  user_id INT NOT NULL,                           -- Relaci贸n con el usuario
  method_type ENUM('password', 'face', 'fingerprint', '2FA') NOT NULL, -- Tipo de autenticaci贸n
  is_active BOOLEAN DEFAULT TRUE,                 -- Si el m茅todo est谩 habilitado
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha de activaci贸n
  extra_data TEXT,                                -- Datos extra (ej: hash facial, ID del dispositivo)
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

--  6. Tipos de documento por usuario
CREATE TABLE document_type (
  id INT AUTO_INCREMENT PRIMARY KEY,              -- ID del tipo de documento
  name TEXT NOT NULL,                             -- Nombre del documento (Ej: C茅dula, Pasaporte)
  acronym TEXT,                                   -- Acr贸nimo (Ej: CC, DNI)
  user_type VARCHAR(20)                           -- Tipo de usuario al que aplica (client, business)
);

--  7. Tipos de documento v谩lidos por pa铆s
CREATE TABLE document_type_by_country (
  country_id INT NOT NULL,                        -- ID del pa铆s
  document_type_id INT NOT NULL,                  -- ID del tipo de documento
  PRIMARY KEY (country_id, document_type_id),
  FOREIGN KEY (country_id) REFERENCES country(id),
  FOREIGN KEY (document_type_id) REFERENCES document_type(id)
);



